<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
<meta charset="UTF-8">
</head>
<style>
div {
	padding-left: 20px;
}
    select {
        width: 150px;
        margin: 10px;
    }
    select:focus {
        min-width: 150px;
        width: auto;
    }    
</style>

<script
	src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

<script type="text/javascript"> 


function setSpeciality(doctorId) {
	$.ajax({
		type: 'GET',
		url: '/availability/' + doctorId,
		success: function(result) {
			var s = '';
			for(var i = 0; i < result.length; i++) {
				s += '<option value="' + result[i].doctorId + '">' + result[i].doctorAvailableTime + '</option>';
			}
			$('#appointmentIdx').html(s);
		}
	});
	
}



$(document).ready(function() {

	$('#specialityIdx').on('change', function(){
         var speciality = $(this).val();
		$.ajax({
			type: 'GET',
			url: '/doctors/speciality/' + speciality,
			success: function(result) {
				
				var s = '';
				for(var i = 0; i < result.length; i++) {
					s += '<option value="' + result[i].id + '">' + result[i].name + '</option>';
				}
				$('#doctorIdx').html(s);
				
					var doctorId = result[0].id;
					setSpeciality(doctorId);
			}
		
		});
	}); 

	$('#doctorIdx').on('change', function(){
		var doctorId = $(this).val();
		setSpeciality(doctorId);
	});

});
</script>

</head>
<body>
	<form autocomplete="on" id="appointmentForm"
		th:action="@{/bookAppointment}" method="post" class="m-t" role="form">

		<h3>Scheduling an appointment</h3>
		<div class="form-group">

			<p><label>Select Speciality</label> <select
				class="form-control selectpicker" id="specialityIdx"
				name="speciality">
				<option value="">Select Speciality</option>
				<option th:each="doctor : ${doctors}"
					th:value="${doctor.speciality}" th:text="${doctor.speciality}">
				</option> 
			</select></p>
			<p> <br> <label>Select Doctor based on specialities</label> <select
				class="form-control" id="doctorIdx" name="name">
				<option value="">Select Doctor</option>
			</select>
			</p>
			<p> <br> <label>Select Doctor Available Time</label> <select
				class="form-control" id="appointmentIdx" name="availability">
				<option value="">Select Appointment</option>

			</select> </p>
	

		<p>
			<label>Reason to visit</label> <input type="text" id="reasonToVisit"/>
		</p>

	<!-- 	<p>
			<label>Appointment Notes</label> <input type="text" id="appointmentNotes"/>
		</p> -->
	</div>
	</form>
	<br>
	<a th:href="@{/appointments}">Check past/upcoming appointments</a>
		<br>
	<a th:href="@{/logout}">Logout</a>
	
</body>
</html>